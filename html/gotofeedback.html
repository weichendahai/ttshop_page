<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
		<title>意见反馈</title>
		<link rel="stylesheet" type="text/css" href="../common/common.css"/>
		<script type="text/javascript" src="../common/rem.js"></script>
		<script type="text/javascript" src="../common/jquery-1.11.1.min.js"></script>
		<script type="text/javascript" src="../common/common.js"></script>
		<script type="text/javascript" src="../common/androidToast.js"></script>
		<style type="text/css">
			.footer{
				width: 100%;
				background: #fe547b;
				height: 1.4rem;
				line-height: 1.4rem;
				text-align: center;
				color: #fff;
				font-size: 0.36rem;
				position: absolute;
				left: 0;
				bottom: 0;
			}
			.say{
				width: 100%;
				height: 1.88rem;
				display: flex;
				display: -webkit-flex;
				box-sizing: border-box;
				-webkit-box-sizing: border-box;
				padding: 0.2rem 0.6rem 0.4rem 0.6rem;
				margin-bottom: 0.2rem;
				background: #fff;
				position: relative;
			}
			.sayleft{
				height: 100%;
				line-height: 0.36rem;
				text-align: right;
			}
			.sayright{
				flex: 1;
				-webkit-flex: 1;
				height: 100%;
				line-height: 0.36rem;
				outline: none;
				resize:none;
				border: none;
				
			}
			section{
				background: #f2f2f2;
			}
			.takephoto{
				width: 100%;
				height: 3rem;
				background:#FFFFFF;
				box-sizing: border-box;
				-webkit-box-sizing: border-box;
				padding: 0 0.6rem ;
			}
			.takephoto .title{
				width: 100%;
				height: 0.8rem;
				line-height: 0.8rem;
			}
			.takephoto .title span{
				color: #c5c5c5;
				
			}
			.takephoto .takephotob{
				width: 100%;
				min-height: 2rem;
				display: flex;
				display: -webkit-flex;
			}
			.takephoto .takephotob .takephotobl{
				width: 1.24rem;
				height: 1.24rem;
				border: 1px solid #e2e2e2;
				margin: 0.2rem 0.2rem 0 0;
				text-align: center;
				line-height: 1.24rem;
				font-size: 0.5rem;
				color: #e2e2e2;
				position: relative;
			}
			#imgTest{
				opacity: 0;
				width: 100%;
				height: 100%;
				position: absolute;
				left: 0;
				top: 0;
				z-index: 999;
			}
			.num{
				position: absolute;
				right: 0.6rem;
				bottom: 0.2rem;
				color: #b6b6b6;
			}
			.num a{
				color: #b6b6b6;
			}
			.pictureshow{
				margin-top: 0.2rem;
				flex: 1;
				-webkit-flex: 1;
				height: auto;
			}
			.pictureshow img{
				display: block;
				width: 70%;
				margin: 0 auto;
			}
		</style>
	</head>
	<body>
		<!--header开始-->
		<header>
			<span class="iconfont goback">&#xe604;</span>意见反馈
		</header>
		<section>
			<div class="say">
				<div class="sayleft">
					反馈问题：
				</div>
				<textarea name="" class="sayright" maxlength="200" rows="" cols="" placeholder="请输入问题"></textarea>
				<div class="num">
					<a>0</a>/200	
				</div>
			</div>
			<div class="takephoto">
				<p class="title">反馈图片<span>（提交问题截图）</span></p>
				<div class="takephotob">
					<div class="takephotobl iconfont">
						&#xe673;
						<input type="file" id="imgTest" type="file" accept="image/*">
					</div>
					<div class="pictureshow">
						<img class="xin" style="display: none;width: 40px; margin: 0 auto;" src="../img/5-121204194026-50.gif"/>
						<img id="showImage" src=""/>
					</div>
				</div>
			</div>
		</section>
		<div class="footer">
			提交
		</div>
	</body>
	<script type="text/javascript">
		var fid = Request.QueryString("fid");
		var user_id = localStorage.getItem("user_id");
		//input监听
		$(".sayright").bind('input propertychange',function(){//input的内容发生变化时
			var len = $(this).val().length;
			$(this).parent(".say").find(".num").find("a").text(len);
			if(len >= 200){
				$(this).parent(".say").find(".num").find("a").css("color","#fe547b")
			}else{
				$(this).parent(".say").find(".num").find("a").css("color","#b6b6b6")
			}
		});
		$("#imgTest").change(function(e){
			imgChange(event)
		});
		$(".footer").click(function(){
			var img_addr = $("#showImage").attr("src");
			var content = encodeURI($(".sayright").val());
			if($(".sayright").val()==''){
				new Toast({context:$('body'),message:"请写反馈内容"}).show(); 
			}else{
				$.ajax({
					type: ajaxtype,
					url: submitfeedback,
					dataType: "jsonp",
					data:{
						user_id:user_id,
						fid:fid,
						content:content,
						img_addr:img_addr
					},
					contentType: "application/json",
					jsonp: "jsonpCallback",
					jsonpCallback:"submitfeedback",
					success: function(data){
						console.log(data)
						if(data.result == 0){
							window.location.href = "myfeedback.html"
						}else{
							new Toast({context:$('body'),message:data.content}).show(); 
						}
					},
					error: function(){
						new Toast({context:$('body'),message:'网络故障'}).show(); 
					}
				})
			}
		})
	</script>
</html>
